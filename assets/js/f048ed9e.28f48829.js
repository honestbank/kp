"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[544],{3482:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"introduction/getting-started","title":"Getting Started with KP","description":"In this guide, we will walk through the steps to set up and use the KP library to process messages from a Kafka topic. We will start by installing the library and its dependencies, then we will write a custom processor function and add middlewares to customize the behavior of the message processing.","source":"@site/docs/introduction/getting-started.md","sourceDirName":"introduction","slug":"/introduction/getting-started","permalink":"/kp/docs/introduction/getting-started","draft":false,"unlisted":false,"editUrl":"https://github.com/honestbank/kp/edit/main/docs/docs/introduction/getting-started.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Introduction","permalink":"/kp/docs/category/introduction"},"next":{"title":"Why use KP?","permalink":"/kp/docs/introduction/why-use-kp"}}');var i=t(4848),r=t(8453);const o={sidebar_position:1},a="Getting Started with KP",c={},d=[{value:"Installation",id:"installation",level:3},{value:"Requirements",id:"requirements",level:3},{value:"Basic Example (publishing messages)",id:"basic-example-producer",level:2},{value:"Basic Example (processing messages)",id:"basic-example-kp",level:2},{value:"Processor function",id:"processor-function",level:3},{value:"Adding Middlewares",id:"adding-middlewares",level:3},{value:"Running the Message Processing",id:"running-the-message-processing",level:3},{value:"Stopping the Message Processing",id:"stopping-the-message-processing",level:3}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"getting-started-with-kp",children:"Getting Started with KP"})}),"\n",(0,i.jsx)(n.p,{children:"In this guide, we will walk through the steps to set up and use the KP library to process messages from a Kafka topic. We will start by installing the library and its dependencies, then we will write a custom processor function and add middlewares to customize the behavior of the message processing."}),"\n",(0,i.jsx)(n.p,{children:"It helps you write applications without worrying too much about the retries, deadlettering, backing off when things go wrong, etc. As a developer, simply focus on business logic and business logic only.\nYour code will be free of retries, backoffs and even tracing, but you'll still able to get all those for free."}),"\n",(0,i.jsx)(n.p,{children:"It also comes with a opinionated producer which can produce typed messages into a given topic."}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["Please check ",(0,i.jsx)(n.a,{href:"/kp/docs/introduction/concepts",children:"this page"})," for very brief concepts of Kafka."]})}),"\n",(0,i.jsx)(n.h3,{id:"installation",children:"Installation"}),"\n",(0,i.jsx)(n.p,{children:"Adding KP as dependency on your project is as simple as running"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"go get github.com/honestbank/kp/v2\n"})}),"\n",(0,i.jsx)(n.h3,{id:"requirements",children:"Requirements"}),"\n",(0,i.jsx)(n.p,{children:"To use KP, you'll need the following:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"go version 1.18 is needed because of the usage of generics"}),"\n",(0,i.jsx)(n.li,{children:"Schema registry to register schema of your topics (can't be disabled currently, maybe in future)"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"cgo"})," needs to be enabled during build of your go code."]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["Please check ",(0,i.jsx)(n.a,{href:"/kp/docs/introduction/configuration",children:"this page"})," for detailed configuration option"]})}),"\n",(0,i.jsx)(n.h2,{id:"basic-example-producer",children:"Basic Example (publishing messages)"}),"\n",(0,i.jsx)(n.p,{children:"A producer can be initialized with a type, and it'll automatically publish the type to schema registry.\nIt requires some environment variables to be set."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n\t"context"\n\n\t"github.com/honestbank/kp/v2/producer"\n)\n\ntype UserLoggedInEvent struct {\n\tUserID string\n}\n\nfunc main() {\n\tp, err := producer.New[UserLoggedInEvent]("user-logged-in", getConfig())\n\tif err != nil {\n\t\tpanic(err) // do better error handling\n\t}\n\tdefer p.Flush()\n\terr = p.Produce(context.Background(), UserLoggedInEvent{UserID: "dummy"})\n\tif err != nil {\n\t\tpanic(err)\n    }\n}\n\nfunc getConfig() any {\n    return nil // return your config\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"basic-example-kp",children:"Basic Example (processing messages)"}),"\n",(0,i.jsx)(n.h3,{id:"processor-function",children:"Processor function"}),"\n",(0,i.jsx)(n.p,{children:"The processor function is the main function that is called for each message in the middleware chain. It should perform the main processing of the message and return an error if any."}),"\n",(0,i.jsx)(n.h3,{id:"adding-middlewares",children:"Adding Middlewares"}),"\n",(0,i.jsx)(n.p,{children:"To add middlewares to the KP instance, you can use the AddMiddleware method. This method takes a middleware as an argument and returns a new KP instance with the middleware added to the chain."}),"\n",(0,i.jsx)(n.h3,{id:"running-the-message-processing",children:"Running the Message Processing"}),"\n",(0,i.jsxs)(n.p,{children:["To start the message processing, you can call the ",(0,i.jsx)(n.code,{children:"Run"})," method on the KP instance and pass the processor function as an argument."]}),"\n",(0,i.jsx)(n.h3,{id:"stopping-the-message-processing",children:"Stopping the Message Processing"}),"\n",(0,i.jsx)(n.p,{children:"To stop the message processing, you can call the Stop method on the KP instance:"}),"\n",(0,i.jsx)(n.p,{children:"This method stops the message processing and releases resources. It is important to call the Stop method when you are finished using the KP instance."}),"\n",(0,i.jsx)(n.p,{children:"Here's what all the above might look like:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n\t"context"\n\t"fmt"\n\t"github.com/confluentinc/confluent-kafka-go/kafka"\n\t"time"\n\n\tv2 "github.com/honestbank/kp/v2"\n)\n\ntype UserLoggedInEvent struct {\n\tUserID string\n}\n\nfunc main() {\n\tkp := v2.New[kafka.Message]()\n\tkp.AddMiddleware(getConsumer())\n\terr := kp.Process(processUserLoggedInEvent)\n\tif err != nil {\n\t\tpanic(err) // do better error handling\n\t}\n}\n\nfunc processUserLoggedInEvent(ctx context.Context, message *kafka.Message) error {\n\t// here, you can focus on your business logic.\n\tfmt.Printf("processing %v\\n", message)\n\ttime.Sleep(time.Millisecond * 200) // simulate long-running process\n\treturn nil                         // or error\n}\n\nfunc getConfig() any {\n\treturn nil // return your config\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var s=t(6540);const i={},r=s.createContext(i);function o(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);